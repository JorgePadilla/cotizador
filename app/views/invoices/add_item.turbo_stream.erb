<%= turbo_stream.append "invoice-items" do %>
  <div class="invoice-item-fields grid grid-cols-1 md:grid-cols-5 gap-4 border-b pb-4 mb-4" data-index="<%= @item_index %>">
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-gray-700">Product</label>
      <select name="invoice[invoice_items_attributes][<%= @item_index %>][product_id]" 
              class="product-select mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              data-action="change->invoice-form#updatePrice">
        <option value="">Select a product</option>
        <% Product.all.each do |product| %>
          <option value="<%= product.id %>" data-price="<%= product.price %>">
            <%= product.name %> - <%= number_to_currency(product.price) %>
          </option>
        <% end %>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Quantity</label>
      <input type="number" 
             name="invoice[invoice_items_attributes][<%= @item_index %>][quantity]" 
             min="1" 
             value="1" 
             class="quantity-input mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
             data-action="input->invoice-form#updateTotals">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Unit Price</label>
      <input type="number" 
             step="0.01" 
             name="invoice[invoice_items_attributes][<%= @item_index %>][unit_price]" 
             class="price-input mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-50 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
             readonly>
    </div>
    <div class="flex items-end">
      <button type="button" 
              class="remove-item-btn mt-1 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
              data-action="click->invoice-form#removeItem">
        Remove
      </button>
    </div>
  </div>
<% end %>